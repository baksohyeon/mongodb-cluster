<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Native WebSocket Example</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background-color: #f5f5f7;
        color: #333;
        text-align: center;
        padding: 20px;
      }
      input {
        margin: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      button {
        padding: 10px 20px;
        background-color: #007aff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background-color: #005bb5;
      }
    </style>
  </head>
  <body>
    <h1>MTT BOT Test</h1>
    <div>
      <input type="text" id="gameIdInput" placeholder="게임 ID 입력" />
      <input type="number" id="countInput" placeholder="요청 수 입력" min="1" />
      <button onClick="reqRegister()">register</button>
    </div>
    <script>
      let serverUrl = "http://localhost:8080/games/register"; // 요기는 serverurl
      let gameId = ""; // 게임 ID 입력
      let count = 1; // 요청 수 입력

      async function reqRegister() {
        gameId = document.getElementById("gameIdInput").value; // 게임 ID 가져오기
        count = parseInt(document.getElementById("countInput").value) || 1; // 요청 수 가져오기

        for (let i = 0; i < count; i++) {
          const chars =
            "ABCDEFGHIJKLMNOPQRSTU VWXYZabcdefghijklmnopqrstuvwxyz0123456789";
          let str = "";
          for (let i = 0; i < 32; i++) {
            str += chars.charAt(Math.floor(Math.random() * chars.length));
          }

          let nick = "";
          for (let i = 0; i < 8; i++) {
            nick += chars.charAt(Math.floor(Math.random() * chars.length));
          }

          let data = {
            gameId: gameId,
            uid: str,
            nick: `BOT_${nick}`,
            password: "",
          };
          console.log("fetch:", i);
          await fetch(serverUrl, {
            method: "POST",
            mode: "cors",
            cache: "no-cache",
            headers: {
              "Content-Type": "application/json",
            },
            redirect: "follow",
            referrerPolicy: "no-referrer",
            body: JSON.stringify(data),
          })
            .then((ret) => {
              if (ret.ok) {
                ret.json().then((data) => {
                  console.log(data);
                });
              } else {
                throw "error!!";
              }
            })
            .catch((error) => {
              showToast(`
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
                            background-color: rgba(0, 0, 0, 0.8); color: white;
                            border-radius: 10px; padding: 16px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                  <h3 style="margin: 0 0 8px; font-weight: 600;">요청 완료</h3>
                  <p style="margin: 0; font-size: 14px; line-height: 1.4;">
                    게임 ID: ${gameId}<br>
                    서버 URL: ${serverUrl}<br>
                    처리된 요청: ${i + 1}/${count}
                  </p>
                </div>
              `);

              function showToast(message) {
                const toast = document.createElement("div");
                toast.innerHTML = message;
                toast.style.position = "fixed";
                toast.style.bottom = "20px";
                toast.style.left = "50%";
                toast.style.transform = "translateX(-50%)";
                toast.style.zIndex = "9999";
                toast.style.transition = "opacity 0.5s, transform 0.5s";
                toast.style.opacity = "0";
                toast.style.transform = "translateX(-50%) translateY(20px)";

                document.body.appendChild(toast);

                setTimeout(() => {
                  toast.style.opacity = "1";
                  toast.style.transform = "translateX(-50%) translateY(0)";
                }, 100);

                setTimeout(() => {
                  toast.style.opacity = "0";
                  toast.style.transform = "translateX(-50%) translateY(20px)";
                  setTimeout(() => {
                    document.body.removeChild(toast);
                  }, 500);
                }, 3000);
              }
            });
        }
      }
    </script>
  </body>
</html>
